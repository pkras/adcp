{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/3.0.0-beta.4/bundled/media-buy/sync-catalogs-request.json",
  "title": "Sync Catalogs Request",
  "description": "Request parameters for syncing catalog feeds with upsert semantics. Supports bulk operations across multiple catalog types (products, inventory, stores, promotions, offerings). Existing catalogs matched by catalog_id are updated, new ones are created. When catalogs is omitted, the call is discovery-only: returns all catalogs on the account without modification.",
  "type": "object",
  "properties": {
    "account": {
      "title": "Account Reference",
      "description": "Account that owns these catalogs.",
      "type": "object",
      "oneOf": [
        {
          "properties": {
            "account_id": {
              "type": "string",
              "description": "Seller-assigned account identifier (from sync_accounts or list_accounts)"
            }
          },
          "required": [
            "account_id"
          ],
          "additionalProperties": false
        },
        {
          "properties": {
            "brand": {
              "title": "Brand Reference",
              "description": "Brand reference identifying the advertiser",
              "type": "object",
              "properties": {
                "domain": {
                  "type": "string",
                  "description": "Domain where /.well-known/brand.json is hosted, or the brand's operating domain",
                  "pattern": "^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$"
                },
                "brand_id": {
                  "title": "Brand ID",
                  "description": "Brand identifier within the house portfolio. Optional for single-brand domains.",
                  "type": "string",
                  "pattern": "^[a-z0-9_]+$",
                  "examples": [
                    "tide",
                    "cheerios",
                    "air_jordan",
                    "nike",
                    "pampers"
                  ]
                }
              },
              "required": [
                "domain"
              ],
              "additionalProperties": false,
              "examples": [
                {
                  "domain": "nova-brands.com",
                  "brand_id": "spark"
                },
                {
                  "domain": "nova-brands.com",
                  "brand_id": "glow"
                },
                {
                  "domain": "acme-corp.com"
                }
              ]
            },
            "operator": {
              "type": "string",
              "description": "Domain of the entity operating on the brand's behalf. When the brand operates directly, this is the brand's domain.",
              "pattern": "^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$"
            }
          },
          "required": [
            "brand",
            "operator"
          ],
          "additionalProperties": false
        }
      ],
      "examples": [
        {
          "account_id": "acc_acme_001"
        },
        {
          "brand": {
            "domain": "acme-corp.com"
          },
          "operator": "acme-corp.com"
        },
        {
          "brand": {
            "domain": "nova-brands.com",
            "brand_id": "spark"
          },
          "operator": "pinnacle-media.com"
        }
      ]
    },
    "catalogs": {
      "type": "array",
      "description": "Array of catalog feeds to sync (create or update). When omitted, the call is discovery-only and returns all existing catalogs on the account without modification.",
      "items": {
        "title": "Catalog",
        "description": "A typed data feed. Catalogs carry the items, locations, stock levels, or pricing that publishers use to render ads. They can be synced to a platform via sync_catalogs (managed lifecycle with approval), provided inline, or fetched from an external URL. The catalog type determines the item schema and can be structural (offering, product, inventory, store, promotion) or vertical-specific (hotel, flight, job, vehicle, real_estate, education, destination, app). Selectors (ids, tags, category, query) filter items regardless of sourcing method.",
        "type": "object",
        "properties": {
          "catalog_id": {
            "type": "string",
            "description": "Buyer's identifier for this catalog. Required when syncing via sync_catalogs. When used in creatives, references a previously synced catalog on the account."
          },
          "name": {
            "type": "string",
            "description": "Human-readable name for this catalog (e.g., 'Summer Products 2025', 'Amsterdam Store Locations')."
          },
          "type": {
            "title": "Catalog Type",
            "description": "Catalog type. Structural types: 'offering' (AdCP Offering objects), 'product' (ecommerce entries), 'inventory' (stock per location), 'store' (physical locations), 'promotion' (deals and pricing). Vertical types: 'hotel', 'flight', 'job', 'vehicle', 'real_estate', 'education', 'destination', 'app' — each with an industry-specific item schema.",
            "type": "string",
            "enum": [
              "offering",
              "product",
              "inventory",
              "store",
              "promotion",
              "hotel",
              "flight",
              "job",
              "vehicle",
              "real_estate",
              "education",
              "destination",
              "app"
            ]
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL to an external catalog feed. The platform fetches and resolves items from this URL. For offering-type catalogs, the feed contains an array of Offering objects. For other types, the feed format is determined by feed_format. When omitted with type 'product', the platform uses its synced copy of the brand's product catalog."
          },
          "feed_format": {
            "title": "Feed Format",
            "description": "Format of the external feed at url. Required when url points to a non-AdCP feed (e.g., Google Merchant Center XML, Meta Product Catalog). Omit for offering-type catalogs where the feed is native AdCP JSON.",
            "type": "string",
            "enum": [
              "google_merchant_center",
              "facebook_catalog",
              "shopify",
              "linkedin_jobs",
              "custom"
            ]
          },
          "update_frequency": {
            "title": "Update Frequency",
            "description": "How often the platform should re-fetch the feed from url. Only applicable when url is provided. Platforms may use this as a hint for polling schedules.",
            "type": "string",
            "enum": [
              "realtime",
              "hourly",
              "daily",
              "weekly"
            ]
          },
          "items": {
            "type": "array",
            "description": "Inline catalog data. The item schema depends on the catalog type: Offering objects for 'offering', StoreItem for 'store', HotelItem for 'hotel', FlightItem for 'flight', JobItem for 'job', VehicleItem for 'vehicle', RealEstateItem for 'real_estate', EducationItem for 'education', DestinationItem for 'destination', AppItem for 'app', or freeform objects for 'product', 'inventory', and 'promotion'. Mutually exclusive with url — provide one or the other, not both. Implementations should validate items against the type-specific schema.",
            "items": {
              "type": "object"
            },
            "minItems": 1
          },
          "ids": {
            "type": "array",
            "description": "Filter catalog to specific item IDs. For offering-type catalogs, these are offering_id values. For product-type catalogs, these are SKU identifiers.",
            "items": {
              "type": "string"
            },
            "minItems": 1
          },
          "gtins": {
            "type": "array",
            "description": "Filter product-type catalogs by GTIN identifiers for cross-retailer catalog matching. Accepts standard GTIN formats (GTIN-8, UPC-A/GTIN-12, EAN-13/GTIN-13, GTIN-14). Only applicable when type is 'product'.",
            "items": {
              "type": "string",
              "pattern": "^[0-9]{8,14}$"
            },
            "minItems": 1
          },
          "tags": {
            "type": "array",
            "description": "Filter catalog to items with these tags. Tags are matched using OR logic — items matching any tag are included.",
            "items": {
              "type": "string"
            },
            "minItems": 1
          },
          "category": {
            "type": "string",
            "description": "Filter catalog to items in this category (e.g., 'beverages/soft-drinks', 'chef-positions')."
          },
          "query": {
            "type": "string",
            "description": "Natural language filter for catalog items (e.g., 'all pasta sauces under $5', 'amsterdam vacancies')."
          },
          "conversion_events": {
            "type": "array",
            "description": "Event types that represent conversions for items in this catalog. Declares what events the platform should attribute to catalog items — e.g., a job catalog converts via submit_application, a product catalog via purchase. The event's content_ids field carries the item IDs that connect back to catalog items. Use content_id_type to declare what identifier type content_ids values represent.",
            "items": {
              "title": "Event Type",
              "description": "Standard marketing event types for event logging, aligned with IAB ECAPI",
              "type": "string",
              "enum": [
                "page_view",
                "view_content",
                "select_content",
                "select_item",
                "search",
                "share",
                "add_to_cart",
                "remove_from_cart",
                "viewed_cart",
                "add_to_wishlist",
                "initiate_checkout",
                "add_payment_info",
                "purchase",
                "refund",
                "lead",
                "qualify_lead",
                "close_convert_lead",
                "disqualify_lead",
                "complete_registration",
                "subscribe",
                "start_trial",
                "app_install",
                "app_launch",
                "contact",
                "schedule",
                "donate",
                "submit_application",
                "custom"
              ],
              "enumDescriptions": {
                "page_view": "User viewed a page",
                "view_content": "User viewed specific content (product, article, etc.)",
                "select_content": "User selected or clicked on content (article, video, etc.)",
                "select_item": "User selected a specific product or item from a list",
                "search": "User performed a search",
                "share": "User shared content via social or messaging",
                "add_to_cart": "User added an item to cart",
                "remove_from_cart": "User removed an item from cart",
                "viewed_cart": "User viewed their shopping cart",
                "add_to_wishlist": "User added an item to a wishlist",
                "initiate_checkout": "User started checkout process",
                "add_payment_info": "User added payment information",
                "purchase": "User completed a purchase",
                "refund": "A purchase was fully or partially refunded (adjusts ROAS)",
                "lead": "User expressed interest (form submission, signup, etc.)",
                "qualify_lead": "Lead qualified by sales or scoring criteria",
                "close_convert_lead": "Lead converted to a customer or closed deal",
                "disqualify_lead": "Lead disqualified or marked as not viable",
                "complete_registration": "User completed account registration",
                "subscribe": "User subscribed to a service or newsletter",
                "start_trial": "User started a free trial",
                "app_install": "User installed an application",
                "app_launch": "User launched an application",
                "contact": "User initiated contact (call, message, etc.)",
                "schedule": "User scheduled an appointment or event",
                "donate": "User made a donation",
                "submit_application": "User submitted an application (loan, job, etc.)",
                "custom": "Custom event type (specify in custom_event_name)"
              }
            },
            "minItems": 1,
            "uniqueItems": true
          },
          "content_id_type": {
            "title": "Content ID Type",
            "description": "Identifier type that the event's content_ids field should be matched against for items in this catalog. For example, 'gtin' means content_ids values are Global Trade Item Numbers, 'sku' means retailer SKUs. Omit when using a custom identifier scheme not listed in the enum.",
            "type": "string",
            "enum": [
              "sku",
              "gtin",
              "offering_id",
              "job_id",
              "hotel_id",
              "flight_id",
              "vehicle_id",
              "listing_id",
              "store_id",
              "program_id",
              "destination_id",
              "app_id"
            ]
          },
          "feed_field_mappings": {
            "type": "array",
            "description": "Declarative normalization rules for external feeds. Maps non-standard feed field names, date formats, price encodings, and image URLs to the AdCP catalog item schema. Applied during sync_catalogs ingestion. Supports field renames, named transforms (date, divide, boolean, split), static literal injection, and assignment of image URLs to typed asset pools.",
            "items": {
              "title": "Catalog Field Mapping",
              "description": "Declares how a field in an external feed maps to the AdCP catalog item schema. Used in sync_catalogs feed_field_mappings to normalize non-AdCP feeds (Google Merchant Center, LinkedIn Jobs XML, hotel XML, etc.) to the standard catalog item schema without requiring the buyer to preprocess every feed. Multiple mappings can assemble a nested object via dot notation (e.g., separate mappings for price.amount and price.currency).",
              "type": "object",
              "properties": {
                "feed_field": {
                  "type": "string",
                  "description": "Field name in the external feed record. Omit when injecting a static literal value (use the value property instead)."
                },
                "catalog_field": {
                  "type": "string",
                  "description": "Target field on the catalog item schema, using dot notation for nested fields (e.g., 'name', 'price.amount', 'location.city'). Mutually exclusive with asset_group_id."
                },
                "asset_group_id": {
                  "type": "string",
                  "description": "Places the feed field value (a URL) into a typed asset pool on the catalog item's assets array. The value is wrapped as an image or video asset in a group with this ID. Use standard group IDs: 'images_landscape', 'images_vertical', 'images_square', 'logo', 'video'. Mutually exclusive with catalog_field."
                },
                "value": {
                  "description": "Static literal value to inject into catalog_field for every item, regardless of what the feed contains. Mutually exclusive with feed_field. Useful for fields the feed omits (e.g., currency when price is always USD, or a constant category value)."
                },
                "transform": {
                  "type": "string",
                  "description": "Named transform to apply to the feed field value before writing to the catalog schema. See transform-specific parameters (format, timezone, by, separator).",
                  "enum": [
                    "date",
                    "divide",
                    "boolean",
                    "split"
                  ]
                },
                "format": {
                  "type": "string",
                  "description": "For transform 'date': the input date format string (e.g., 'YYYYMMDD', 'MM/DD/YYYY', 'DD-MM-YYYY'). Output is always ISO 8601 (e.g., '2025-03-01'). Uses Unicode date pattern tokens."
                },
                "timezone": {
                  "type": "string",
                  "description": "For transform 'date': the timezone of the input value. IANA timezone identifier (e.g., 'UTC', 'America/New_York', 'Europe/Amsterdam'). Defaults to UTC when omitted."
                },
                "by": {
                  "type": "number",
                  "description": "For transform 'divide': the divisor to apply (e.g., 100 to convert integer cents to decimal dollars).",
                  "exclusiveMinimum": 0
                },
                "separator": {
                  "type": "string",
                  "description": "For transform 'split': the separator character or string to split on. Defaults to ','.",
                  "default": ","
                },
                "default": {
                  "description": "Fallback value to use when feed_field is absent, null, or empty. Applied after any transform would have been applied. Allows optional feed fields to have a guaranteed baseline value."
                },
                "ext": {
                  "title": "Extension Object",
                  "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
                  "type": "object",
                  "additionalProperties": true
                }
              },
              "allOf": [
                {
                  "not": {
                    "required": [
                      "feed_field",
                      "value"
                    ]
                  }
                },
                {
                  "not": {
                    "required": [
                      "catalog_field",
                      "asset_group_id"
                    ]
                  }
                }
              ],
              "additionalProperties": true,
              "examples": [
                {
                  "description": "Simple field rename",
                  "data": {
                    "feed_field": "hotel_name",
                    "catalog_field": "name"
                  }
                },
                {
                  "description": "Date format transform — YYYYMMDD to ISO 8601",
                  "data": {
                    "feed_field": "available_from",
                    "catalog_field": "valid_from",
                    "transform": "date",
                    "format": "YYYYMMDD",
                    "timezone": "UTC"
                  }
                },
                {
                  "description": "Divide cents to dollars",
                  "data": {
                    "feed_field": "price_cents",
                    "catalog_field": "price.amount",
                    "transform": "divide",
                    "by": 100
                  }
                },
                {
                  "description": "Static literal injection — currency not in feed",
                  "data": {
                    "catalog_field": "price.currency",
                    "value": "USD"
                  }
                },
                {
                  "description": "Image URL assigned to typed asset pool",
                  "data": {
                    "feed_field": "primary_photo_url",
                    "asset_group_id": "images_landscape"
                  }
                },
                {
                  "description": "Vertical photo URL assigned to vertical pool",
                  "data": {
                    "feed_field": "portrait_photo_url",
                    "asset_group_id": "images_vertical"
                  }
                },
                {
                  "description": "Split comma-separated tags to array",
                  "data": {
                    "feed_field": "amenity_list",
                    "catalog_field": "amenities",
                    "transform": "split",
                    "separator": ","
                  }
                },
                {
                  "description": "Boolean coercion with default",
                  "data": {
                    "feed_field": "is_available",
                    "catalog_field": "available",
                    "transform": "boolean",
                    "default": false
                  }
                }
              ]
            },
            "minItems": 1
          }
        },
        "required": [
          "type"
        ],
        "additionalProperties": true,
        "examples": [
          {
            "description": "Synced product catalog from Google Merchant Center",
            "data": {
              "catalog_id": "gmc-primary",
              "name": "Primary Product Feed",
              "type": "product",
              "url": "https://feeds.acmecorp.com/products.xml",
              "feed_format": "google_merchant_center",
              "update_frequency": "daily"
            }
          },
          {
            "description": "Inventory feed for store-level stock data",
            "data": {
              "catalog_id": "store-inventory",
              "name": "Store Inventory",
              "type": "inventory",
              "url": "https://feeds.acmecorp.com/inventory.json",
              "feed_format": "custom",
              "update_frequency": "hourly"
            }
          },
          {
            "description": "Store locator feed",
            "data": {
              "catalog_id": "retail-locations",
              "name": "Retail Locations",
              "type": "store",
              "url": "https://feeds.acmecorp.com/stores.json",
              "feed_format": "custom",
              "update_frequency": "weekly"
            }
          },
          {
            "description": "Promotional pricing feed",
            "data": {
              "catalog_id": "summer-sale",
              "name": "Summer Sale Promotions",
              "type": "promotion",
              "url": "https://feeds.acmecorp.com/promotions.json",
              "feed_format": "google_merchant_center",
              "update_frequency": "daily"
            }
          },
          {
            "description": "Inline offering catalog (no sync needed)",
            "data": {
              "type": "offering",
              "items": [
                {
                  "offering_id": "summer-sale",
                  "name": "Summer Sale",
                  "landing_url": "https://acme.com/summer"
                }
              ]
            }
          },
          {
            "description": "Reference to a previously synced catalog by ID",
            "data": {
              "catalog_id": "gmc-primary",
              "type": "product",
              "ids": [
                "SKU-12345",
                "SKU-67890"
              ]
            }
          },
          {
            "description": "Product catalog with GTIN cross-retailer matching and attribution",
            "data": {
              "type": "product",
              "gtins": [
                "00013000006040",
                "00013000006057"
              ],
              "content_id_type": "gtin",
              "conversion_events": [
                "purchase",
                "add_to_cart"
              ]
            }
          },
          {
            "description": "Inline store catalog with catchment areas",
            "data": {
              "catalog_id": "retail-locations",
              "name": "Retail Locations",
              "type": "store",
              "items": [
                {
                  "store_id": "amsterdam-flagship",
                  "name": "Amsterdam Flagship",
                  "location": {
                    "lat": 52.3676,
                    "lng": 4.9041
                  },
                  "catchments": [
                    {
                      "catchment_id": "walk",
                      "travel_time": {
                        "value": 10,
                        "unit": "min"
                      },
                      "transport_mode": "walking"
                    },
                    {
                      "catchment_id": "drive",
                      "travel_time": {
                        "value": 15,
                        "unit": "min"
                      },
                      "transport_mode": "driving"
                    }
                  ]
                }
              ]
            }
          }
        ]
      },
      "minItems": 1,
      "maxItems": 50
    },
    "catalog_ids": {
      "type": "array",
      "description": "Optional filter to limit sync scope to specific catalog IDs. When provided, only these catalogs will be created/updated. Other catalogs on the account are unaffected.",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "maxItems": 50
    },
    "delete_missing": {
      "type": "boolean",
      "default": false,
      "description": "When true, buyer-managed catalogs on the account not included in this sync will be removed. Does not affect seller-managed catalogs. Do not combine with an omitted catalogs array or all buyer-managed catalogs will be deleted."
    },
    "dry_run": {
      "type": "boolean",
      "default": false,
      "description": "When true, preview changes without applying them. Returns what would be created/updated/deleted."
    },
    "validation_mode": {
      "title": "Validation Mode",
      "description": "Validation strictness. 'strict' fails entire sync on any validation error. 'lenient' processes valid catalogs and reports errors.",
      "type": "string",
      "enum": [
        "strict",
        "lenient"
      ],
      "default": "strict"
    },
    "push_notification_config": {
      "title": "Push Notification Config",
      "description": "Optional webhook configuration for async sync notifications. Publisher will send webhook when sync completes if operation takes longer than immediate response time (common for large feeds requiring platform review).",
      "type": "object",
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Webhook endpoint URL for task status notifications"
        },
        "token": {
          "type": "string",
          "description": "Optional client-provided token for webhook validation. Echoed back in webhook payload to validate request authenticity.",
          "minLength": 16
        },
        "authentication": {
          "type": "object",
          "description": "Authentication configuration for webhook delivery (A2A-compatible)",
          "properties": {
            "schemes": {
              "type": "array",
              "description": "Array of authentication schemes. Supported: ['Bearer'] for simple token auth, ['HMAC-SHA256'] for signature verification (recommended for production)",
              "items": {
                "title": "Authentication Scheme",
                "description": "Authentication schemes for push notification endpoints",
                "type": "string",
                "enum": [
                  "Bearer",
                  "HMAC-SHA256"
                ]
              },
              "minItems": 1,
              "maxItems": 1
            },
            "credentials": {
              "type": "string",
              "description": "Credentials for authentication. For Bearer: token sent in Authorization header. For HMAC-SHA256: shared secret used to generate signature. Minimum 32 characters. Exchanged out-of-band during onboarding.",
              "minLength": 32
            }
          },
          "required": [
            "schemes",
            "credentials"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "url",
        "authentication"
      ]
    },
    "context": {
      "title": "Context Object",
      "description": "Opaque correlation data that is echoed unchanged in responses. Used for internal tracking, UI session IDs, trace IDs, and other caller-specific identifiers that don't affect protocol behavior. Context data is never parsed by AdCP agents - it's simply preserved and returned.",
      "type": "object",
      "additionalProperties": true
    },
    "ext": {
      "title": "Extension Object",
      "description": "Extension object for platform-specific, vendor-namespaced parameters. Extensions are always optional and must be namespaced under a vendor/platform key (e.g., ext.gam, ext.roku). Used for custom capabilities, partner-specific configuration, and features being proposed for standardization.",
      "type": "object",
      "additionalProperties": true
    }
  },
  "required": [
    "account"
  ],
  "if": {
    "properties": {
      "delete_missing": {
        "const": true
      }
    },
    "required": [
      "delete_missing"
    ]
  },
  "then": {
    "required": [
      "catalogs"
    ],
    "errorMessage": "catalogs is required when delete_missing is true — omitting it would delete all buyer-managed catalogs on the account"
  },
  "additionalProperties": true,
  "examples": [
    {
      "description": "Sync product and inventory feeds for a retail media campaign",
      "data": {
        "account": {
          "account_id": "acct_acmecorp"
        },
        "catalogs": [
          {
            "catalog_id": "product-feed",
            "name": "Acme Product Catalog",
            "type": "product",
            "url": "https://feeds.acmecorp.com/products.xml",
            "feed_format": "google_merchant_center",
            "update_frequency": "daily"
          },
          {
            "catalog_id": "inventory-feed",
            "name": "Store Inventory",
            "type": "inventory",
            "url": "https://feeds.acmecorp.com/inventory.json",
            "feed_format": "custom",
            "update_frequency": "hourly"
          }
        ]
      }
    },
    {
      "description": "Sync inline offerings for a recruitment campaign",
      "data": {
        "account": {
          "account_id": "acct_restaurants"
        },
        "catalogs": [
          {
            "catalog_id": "chef-vacancies",
            "name": "Chef Position Vacancies",
            "type": "offering",
            "items": [
              {
                "offering_id": "chef-amsterdam-42",
                "name": "Head Chef - Amsterdam",
                "description": "Lead our kitchen team in central Amsterdam",
                "landing_url": "https://jobs.acme-restaurants.com/chef-amsterdam-42",
                "geo_targets": {
                  "countries": [
                    "NL"
                  ],
                  "regions": [
                    "NL-NH"
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      "description": "Discovery-only: list all catalogs on the account",
      "data": {
        "account": {
          "account_id": "acct_acmecorp"
        }
      }
    }
  ],
  "_bundled": {
    "generatedAt": "2026-02-26T12:28:33.837Z",
    "note": "This is a bundled schema with all $ref resolved inline. For the modular version with references, use the parent directory."
  }
}