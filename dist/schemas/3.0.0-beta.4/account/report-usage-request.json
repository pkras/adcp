{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "/schemas/3.0.0-beta.4/account/report-usage-request.json",
  "title": "Report Usage Request",
  "description": "Reports how a vendor's service was consumed after campaign delivery. Used by orchestrators (DSPs, storefronts) to inform vendor agents (signals, governance, creative) what was used so the vendor can track earned revenue and verify billing. Records can span multiple accounts and campaigns in a single request.",
  "type": "object",
  "properties": {
    "idempotency_key": {
      "type": "string",
      "description": "Client-generated unique key for this request. If a request with the same key has already been accepted, the server returns the original response without re-processing. Use a UUID or other unique identifier. Prevents duplicate billing on retries."
    },
    "reporting_period": {
      "type": "object",
      "description": "The time range covered by this usage report. Applies to all records in the request.",
      "properties": {
        "start": {
          "type": "string",
          "format": "date-time",
          "description": "Start of the reporting period (inclusive), in UTC."
        },
        "end": {
          "type": "string",
          "format": "date-time",
          "description": "End of the reporting period (inclusive), in UTC."
        }
      },
      "required": ["start", "end"],
      "additionalProperties": false
    },
    "usage": {
      "type": "array",
      "description": "One or more usage records. Each record is self-contained: it carries its own account and buyer_campaign_ref, allowing a single request to span multiple accounts and campaigns.",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "account": {
            "$ref": "/schemas/3.0.0-beta.4/core/account-ref.json",
            "description": "Account for this usage record."
          },
          "buyer_campaign_ref": {
            "type": "string",
            "description": "The buyer's campaign reference (e.g., a media_buy_id). Used to group records by campaign."
          },
          "vendor_cost": {
            "type": "number",
            "minimum": 0,
            "description": "Amount owed to the vendor for this record, denominated in currency."
          },
          "currency": {
            "type": "string",
            "pattern": "^[A-Z]{3}$",
            "description": "ISO 4217 currency code."
          },
          "pricing_option_id": {
            "type": "string",
            "description": "Pricing option identifier from the vendor's discovery response (e.g., get_signals, list_content_standards). The vendor uses this to verify the correct rate was applied."
          },
          "impressions": {
            "type": "integer",
            "minimum": 0,
            "description": "Impressions delivered using this vendor service."
          },
          "media_spend": {
            "type": "number",
            "minimum": 0,
            "description": "Media spend in currency for the period. Required when a percent_of_media pricing model was used, so the vendor can verify the applied rate."
          },
          "signal_agent_segment_id": {
            "type": "string",
            "description": "Signal identifier from get_signals. Required for signals agents."
          },
          "standards_id": {
            "type": "string",
            "description": "Content standards configuration identifier. Required for governance agents."
          }
        },
        "required": ["account", "vendor_cost", "currency"],
        "additionalProperties": true
      }
    },
    "context": {
      "$ref": "/schemas/3.0.0-beta.4/core/context.json"
    },
    "ext": {
      "$ref": "/schemas/3.0.0-beta.4/core/ext.json"
    }
  },
  "required": ["reporting_period", "usage"],
  "additionalProperties": true,
  "examples": [
    {
      "description": "Signal usage for a single campaign",
      "data": {
        "idempotency_key": "550e8400-e29b-41d4-a716-446655440000",
        "reporting_period": {
          "start": "2025-03-01T00:00:00Z",
          "end": "2025-03-31T23:59:59Z"
        },
        "usage": [
          {
            "account": { "account_id": "acct_pinnacle_signals" },
            "buyer_campaign_ref": "mb_spring_launch_001",
            "signal_agent_segment_id": "luxury_auto_intenders",
            "pricing_option_id": "po_lux_auto_cpm",
            "impressions": 4200000,
            "media_spend": 21000.00,
            "vendor_cost": 2100.00,
            "currency": "USD"
          }
        ]
      }
    },
    {
      "description": "Multi-account batch across two campaigns",
      "data": {
        "reporting_period": {
          "start": "2025-03-01T00:00:00Z",
          "end": "2025-03-31T23:59:59Z"
        },
        "usage": [
          {
            "account": { "account_id": "acct_pinnacle_signals" },
            "buyer_campaign_ref": "mb_spring_q1_001",
            "signal_agent_segment_id": "luxury_auto_intenders",
            "pricing_option_id": "po_lux_auto_cpm",
            "impressions": 2100000,
            "vendor_cost": 1050.00,
            "currency": "USD"
          },
          {
            "account": { "account_id": "acct_nova" },
            "buyer_campaign_ref": "mb_summer_preview_002",
            "signal_agent_segment_id": "eco_conscious_shoppers",
            "pricing_option_id": "po_eco_cpm",
            "impressions": 800000,
            "vendor_cost": 400.00,
            "currency": "USD"
          }
        ]
      }
    }
  ]
}
